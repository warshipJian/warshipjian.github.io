(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{425:function(t,e,s){"use strict";s.r(e);var a=s(26),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"搭建ngrok服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#搭建ngrok服务"}},[t._v("#")]),t._v(" 搭建ngrok服务")]),t._v(" "),s("p",[t._v("回调地址需要固定ip或域名，每次都去服务器调略麻烦，用ngrok可以将本机暴露在公网，实现本地调试的目的。")]),t._v(" "),s("h2",{attrs:{id:"准备配件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#准备配件"}},[t._v("#")]),t._v(" 准备配件##")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("一台有公网ip的服务器\n一个可用的域名\n")])])]),s("p",[t._v("服务器配置")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("这里服务器的系统用的是centos 7 \n对外开放80，443，4443端口\n")])])]),s("p",[t._v("域名配置")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("将该域名的一个子域名解析到这台服务器\n比如域名为test.com，可以将ngrok.test.com解析到该服务器,添加两个ngrok.test.com的A记录,如\nngrok.test.com\n*.ngrok.test.com\n")])])]),s("h2",{attrs:{id:"开始搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开始搭建"}},[t._v("#")]),t._v(" 开始搭建##")]),t._v(" "),s("p",[s("strong",[t._v("一. 安装git，golang，openssl")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("yum install -y git golang openssl\n")])])]),s("p",[s("strong",[t._v("二. 将ngrok克隆到本地")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("git clone https://github.com/inconshreveable/ngrok.git /usr/local/ngrok\n")])])]),s("p",[s("strong",[t._v("三.生成证书")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('# 使用下面命令生成证书，注意将ngrok.test.com替换为你的域名\ncd /usr/local/ngrok\nopenssl genrsa -out rootCA.key 2048\nopenssl req -x509 -new -nodes -key rootCA.key -subj "/CN=ngrok.test.com" -days 5000 -out rootCA.pem\nopenssl genrsa -out device.key 2048\nopenssl req -new -key device.key -subj "/CN=ngrok.test.com" -out device.csr\nopenssl x509 -req -in device.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out device.crt -days 5000\n\n# 将我们生成的证书替换ngrok默认的证书\n\\cp -r rootCA.pem assets/client/tls/ngrokroot.crt\n\\cp -r device.crt assets/server/tls/snakeoil.crt\n\\cp -r device.key assets/server/tls/snakeoil.key\n')])])]),s("p",[s("strong",[t._v("四.编译不同平台的服务端和客户端")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("生成服务端\nmake release-server\n\n生成客户端\nGOOS=linux GOARCH=amd64 make release-client\nGOOS=windows GOARCH=amd64 make release-client\nGOOS=darwin GOARCH=amd64 make release-client\n")])])]),s("p",[t._v("这里编译的时间和服务器的网络有关系，国内网络时间会长一点，可能还会出现中断的情况，可多尝试几次。实在不行就走"),s("a",{attrs:{href:"https://blog.csdn.net/u012375924/article/details/78706910",target:"_blank",rel:"noopener noreferrer"}},[t._v("代理"),s("OutboundLink")],1),t._v("  o("),s("em",[t._v("￣︶￣")]),t._v(")o")]),t._v(" "),s("p",[t._v("客户端对应的系统参考如下")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Linux 平台 32 位系统：GOOS=linux GOARCH=386\nLinux 平台 64 位系统：GOOS=linux GOARCH=amd64\n\nWindows 平台 32 位系统：GOOS=windows GOARCH=386\nWindows 平台 64 位系统：GOOS=windows GOARCH=amd64\n\nMAC 平台 32 位系统：GOOS=darwin GOARCH=386\nMAC 平台 64 位系统：GOOS=darwin GOARCH=amd64\n\nARM 平台：GOOS=linux GOARCH=arm\n")])])]),s("p",[t._v("编译完成后，将./bin下面对应的客户端文件拷贝到本地，注意是ngrok的，不是ngrokd")]),t._v(" "),s("h2",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[t._v("#")]),t._v(" 使用##")]),t._v(" "),s("p",[s("strong",[t._v("一.启动服务端")])]),t._v(" "),s("p",[t._v("在服务器上运行如下命令，注意域名替换为你的域名")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('nohup ./bin/ngrokd -domain="ngrok.test.com" -httpAddr=":80" -httpsAddr=":443" -tunnelAddr=":4443" &\n')])])]),s("p",[t._v("这里启动了80，443，4443这些端口，4443用于和客户端连接")]),t._v(" "),s("p",[s("strong",[t._v("二.启动客户端")])]),t._v(" "),s("p",[t._v("在本地新建一个文件ngrok.cfg，内容如下")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('server_addr: "ngrok.test.com:4443"\ntrust_host_root_certs: false\n')])])]),s("p",[t._v("将服务端编译好的客户端文件拷贝到本地，启动")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("ngrok -subdomain pay -config=./ngrok.cfg 80\n# 这里指将本地的80端口通过ngrok暴露到公网\n")])])]),s("p",[t._v("如果正常的话，可以看到如下信息")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("ngrok                                                                                                                                         (Ctrl+C to quit)\n                                                                                                                                                              \nTunnel Status                 online                                                                                                                          \nVersion                       1.7/1.7                                                                                                                         \nForwarding                    https://pay.ngrok.test.com -> 127.0.0.1:80                                                                                \nForwarding                    http://pay.ngrok.test.com -> 127.0.0.1:80                                                                                 \nWeb Interface                 127.0.0.1:4040                                                                                                                  \n# Conn                        0                                                                                                                               \nAvg Conn Time                 0.00ms                                                                                                                                                                \n")])])]),s("p",[t._v("打开浏览器，访问http://pay.ngrok.test.com，即可访问到本机127.0.0.1:80内容")]),t._v(" "),s("p",[s("strong",[t._v("三.查看使用情况")])]),t._v(" "),s("p",[t._v("默认访问如下页面，可看到ngrok的相关信息\nhttp://127.0.0.1:4040/http/in")])])}),[],!1,null,null,null);e.default=n.exports}}]);