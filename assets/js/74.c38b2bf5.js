(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{426:function(a,t,s){"use strict";s.r(t);var e=s(26),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"nagios下用grafana绘图-二"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nagios下用grafana绘图-二"}},[a._v("#")]),a._v(" nagios下用grafana绘图(二)")]),a._v(" "),s("p",[a._v("现在不需要安装elasticsearch了,所以省去了很多步骤.")]),a._v(" "),s("p",[a._v("使用如下工具:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("graphite\ngrafana-3.1.1-1470047149.x86_64\ngraphios\n")])])]),s("p",[a._v("部署环境:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("Centos 6.5\npython 2.6\nnagios 4.1.1\n")])])]),s("h2",{attrs:{id:"一-安装graphite"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一-安装graphite"}},[a._v("#")]),a._v(" 一.安装graphite")]),a._v(" "),s("p",[a._v("1.关闭selinux")]),a._v(" "),s("p",[a._v("2.安装依赖工具")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("yum install epel-release -y\nyum install bitmap bitmap-fonts-compat Django django-tagging fontconfig cairo python-devel python-memcached python-twisted  pycairo mod_python python-ldap python-simplejson memcached python-zope-interface mod_wsgi python-sqlite2  Django MySQL-python  -y\n")])])]),s("p",[a._v("安装pytz")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v(" pip install pytz\n")])])]),s("p",[a._v("carbon依赖Twisted,如果是python2.6,新版的Twisted不支持python2.6,需手动安装支持2.6的版本,这里用Twisted-15")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("wget https://pypi.python.org/packages/76/9a/ed7a9cabefd919c861249d39d11111d5d8fba2e8d0b2a1bce7ee8933a8fd/Twisted-15.0.0.tar.bz2#md5=f52bfe112a3aa33dd1d323c7c1e99f16\ntar jxvf Twisted-15.0.0.tar.bz2\ncd Twisted-15.0.0\npython setup.py install\n")])])]),s("p",[a._v("3.安装graphite")]),a._v(" "),s("p",[a._v("使用pip安装")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("pip install whisper\npip install carbon\npip install graphite-web\n")])])]),s("p",[a._v("添加配置文件")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cd /opt/graphite/conf/\ncp carbon.conf.example carbon.conf\ncp storage-schemas.conf.example storage-schemas.conf\ncp graphite.wsgi.example graphite.wsgi\n")])])]),s("p",[a._v("4.配置apache")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cat /opt/graphite/examples/example-graphite-vhost.conf  >> /etc/httpd/conf/httpd.conf\n\nvim /etc/httpd/conf/httpd.conf\n添加 \nListen 8081\n\n修改端口为8081\n<VirtualHost *:8081>\n\n修改WSGISocketPrefix 为 \nWSGISocketPrefix /var/run/httpd/wsgi\n\n初始化数据库\ncd /opt/graphite/webapp/graphite/\ncp local_settings.py.example local_settings.py\npython manage.py syncdb\nchown -R apache:apache /opt/graphite\n")])])]),s("p",[a._v("5.启动graphite")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("/opt/graphite/bin/carbon-cache.py start\nservice  httpd restart\n")])])]),s("p",[a._v("访问http://ip:8081 即可进入graphite")]),a._v(" "),s("h2",{attrs:{id:"二-安装配置graphios"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二-安装配置graphios"}},[a._v("#")]),a._v(" 二.安装配置graphios")]),a._v(" "),s("h3",{attrs:{id:"_1-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装"}},[a._v("#")]),a._v(" 1.安装")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("git clone https://github.com/shawn-sterling/graphios.git\ncd graphios\npython setup.py install\n\nmkdir -p /var/spool/nagios/graphios\nchown nagios:nagios -R /var/spool/nagios\n")])])]),s("h3",{attrs:{id:"_2-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置"}},[a._v("#")]),a._v(" 2.配置")]),a._v(" "),s("p",[a._v("安装完成后,会自动在/usr/local/nagios/etc/nagios.cfg中添加graphios的配置")]),a._v(" "),s("p",[a._v("注释掉这行,避免配置冲突")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cfg_dir=/usr/local/nagios/etc/objects\n")])])]),s("p",[a._v("手动添加command的配置")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vim /usr/local/nagios/etc/objects/commands.cfg\ndefine command {\n        command_name    graphite_perf_host\n        command_line    /bin/mv /var/spool/nagios/graphios/host-perfdata /var/spool/nagios/graphios/host-perfdata.$TIMET$\n        }\n\ndefine command {\n        command_name    graphite_perf_service\n        command_line    /bin/mv /var/spool/nagios/graphios/service-perfdata /var/spool/nagios/graphios/service-perfdata.$TIMET$\n        }\n\n在nagios对应的主机或服务中,添加 _graphiteprefix 值\n如\ndefine host {\n    host_name                   gzimg110\n    check_command               check_ping\n    _graphiteprefix                ping\n}\n")])])]),s("h3",{attrs:{id:"_3-配置graphios"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置graphios"}},[a._v("#")]),a._v(" 3.配置graphios")]),a._v(" "),s("p",[a._v("vim /etc/graphios/graphios.cfg")]),a._v(" "),s("p",[a._v("修改如下内容")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("debug = False\nenable_carbon = True\nsleep_max = 3\n")])])]),s("p",[a._v("vim /usr/bin/graphios.py")]),a._v(" "),s("p",[a._v("将对应值修改为如下内容")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("config_file = '/etc/graphios/graphios.cfg'\ndebug = False\n")])])]),s("p",[a._v("启动graphios")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("service graphios start\nservice nagios restart\n")])])]),s("p",[a._v("可以查看日志,看是否正常")]),a._v(" "),s("p",[a._v("tail /usr/local/nagios/var/graphios.log")]),a._v(" "),s("p",[a._v("查看/opt/graphite/storage/whisper/下是否有对应的文件产生")]),a._v(" "),s("h2",{attrs:{id:"三-安装配置grafana"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三-安装配置grafana"}},[a._v("#")]),a._v(" 三.安装配置grafana")]),a._v(" "),s("h3",{attrs:{id:"_1-安装-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-2"}},[a._v("#")]),a._v(" 1.安装")]),a._v(" "),s("p",[a._v("可以访问官网获取最新的版本")]),a._v(" "),s("p",[a._v("http://docs.grafana.org/")]),a._v(" "),s("p",[a._v("本次使用3.1.1")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("wget https://grafanarel.s3.amazonaws.com/builds/grafana-3.1.1-1470047149.x86_64.rpm\n\nrpm -ivh grafana-3.1.1-1470047149.x86_64.rpm\n")])])]),s("h3",{attrs:{id:"_2-配置-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置-2"}},[a._v("#")]),a._v(" 2.配置")]),a._v(" "),s("p",[a._v("grafana默认使用3000端口")]),a._v(" "),s("p",[a._v("vim /etc/grafana/grafana.ini")]),a._v(" "),s("p",[a._v("开启如下选项")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("protocol = http\nhttp_port = 3000\nadmin_user = admin\nadmin_password = admin\n")])])]),s("h3",{attrs:{id:"_3-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用"}},[a._v("#")]),a._v(" 3.使用")]),a._v(" "),s("p",[a._v("启动grafana")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("service  grafana-server start\n")])])]),s("p",[a._v("打开浏览器,访问grafana")]),a._v(" "),s("p",[a._v("http://ip:3000")]),a._v(" "),s("p",[a._v("按如下步骤,添加graphite数据源")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img.xiaoxiaoguo.cn/usr/uploads/2017/07/1653710540.jpg",alt:"nagios1.jpg"}})]),a._v(" "),s("p",[a._v("添加完成后,点开dashborads,即可添加对应的服务了.")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img.xiaoxiaoguo.cn/usr/uploads/2017/07/696676816.jpg",alt:"nagios2.jpg"}})]),a._v(" "),s("p",[a._v("最终效果:")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img.xiaoxiaoguo.cn/usr/uploads/2017/07/3364498227.jpg",alt:"nagios3.jpg"}})])])}),[],!1,null,null,null);t.default=r.exports}}]);