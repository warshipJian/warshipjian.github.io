(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{377:function(t,a,s){"use strict";s.r(a);var e=s(26),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"守护进程-01-tmux"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#守护进程-01-tmux"}},[t._v("#")]),t._v(" 守护进程-01-tmux")]),t._v(" "),s("h3",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("一般要在服务器上做一些花里胡哨的操作时，都是打开终端(如果是远程服务器，则还需要通过ssh连接下)在上面操作。你会发现当你的ssh断开或关闭terminal时，你在上面临时运行的程序也停掉了，这是为什么呢，今天就来讨论下这个问题。")]),t._v(" "),s("h3",{attrs:{id:"terminal和shell"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#terminal和shell"}},[t._v("#")]),t._v(" terminal和shell")]),t._v(" "),s("p",[t._v("关于终端和shell的来由说起来就话长了，这里不做赘述，可以看下这篇文章"),s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/61369678",target:"_blank",rel:"noopener noreferrer"}},[t._v("Linux Cygwin知识库（一）：一文搞清控制台、终端、shell概念"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("简单来说：terminal是帮你输入和显示命令结果的，shell是帮你执行命令的。")]),t._v(" "),s("p",[t._v("从进程会话的角度来说，它们的包含关系如下：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.xiaoxiaoguo.cn/usr/uploads/2020/01/4265723006.png",alt:"terminal.png"}})]),t._v(" "),s("p",[t._v("a.out是一个示例程序：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('main()\n{\n    while(1){\n        printf("hello\\n");\n        sleep(10);\n    };\n}\n')])])]),s("p",[t._v("gcc编译后，把它运行起来，看下它的pid，ppid，gid，sid")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# pidof a.out\n28505\n# ps -C a.out -o pid,ppid,gid,sid\n  PID  PPID   GID   SID\n28505 28266     0 28266\n")])])]),s("p",[t._v("可以看到ppid和sid是同一个，是bash")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# ps aux | grep 28266\nroot     28266  0.0  0.0  22872  5436 pts/0    Ss   14:37   0:00 -bash\n")])])]),s("p",[t._v("再看下bash的ppid，以及它对应的进程，可以看到是sshd（我这里是通过ssh连接操作的服务器）")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# ps -ef | grep bash\nroot     28266 28165  0 14:37 pts/0    00:00:00 -bash\n# ps -ef | grep 28165\nroot     28165  1354  0 14:37 ?        00:00:00 sshd: root@pts/0\n")])])]),s("p",[t._v("当关闭a.out的终端时可以看到a.out也没有运行了，而现实的场景中肯定会遇到要守护进程的方式，即终端关掉以后程序可以继续运行。在linux下常见的有daemon，systemed，nohup，后续会一一介绍这些，这里先介绍一个工具tmux。")]),t._v(" "),s("h3",{attrs:{id:"tmux"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tmux"}},[t._v("#")]),t._v(" tmux")]),t._v(" "),s("p",[t._v("在Ubuntu下安装")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("apt-get install tmux\n")])])]),s("p",[t._v("在centos下安装")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("yum install tmux\n")])])]),s("p",[t._v("安装完成后，直接运行tmux命令即可进入\n此时运行a.out，然后关闭该终端，可以看到a.out还在运行：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# ps aux  | grep a.out\nroot     29299  0.0  0.0   4508   712 pts/2    S+   15:10   0:00 ./a.out\n")])])]),s("p",[t._v("看下它的父进程：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("root@lan-dev-215:~/test# ps -ef | grep 29272\nroot     29272 29271  0 15:10 pts/2    00:00:00 -bash\nroot     29299 29272  0 15:10 pts/2    00:00:00 ./a.out\nroot     29333 28266  0 15:12 pts/0    00:00:00 grep --color=auto 29272\nroot@lan-dev-215:~/test# ps -ef | grep 29271\nroot     29271     1  0 15:10 ?        00:00:00 tmux\nroot     29272 29271  0 15:10 pts/2    00:00:00 -bash\nroot     29344 28266  0 15:12 pts/0    00:00:00 grep --color=auto 29271\n")])])]),s("p",[t._v("可以看到对应的bash是tmux启动的，我们把tmux杀掉看会怎么样")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("root@lan-dev-215:~/test# kill -9 29271\nroot@lan-dev-215:~/test# ps -ef | grep 29271\nroot     29384 28266  0 15:14 pts/0    00:00:00 grep --color=auto 29271\nroot@lan-dev-215:~/test# ps -ef | grep a.out\nroot     29387 28266  0 15:14 pts/0    00:00:00 grep --color=auto a.out\nroot@lan-dev-215:~/test# ps -ef | grep tmux\nroot     29390 28266  0 15:14 pts/0    00:00:00 grep --color=auto tmux\n")])])]),s("p",[t._v("可以看到a.out也没了。")]),t._v(" "),s("p",[t._v("到这里我们就明白了：tmux是一个守护进程，不受terminal的影响，从而保证了在它上面运行的程序可以继续运行。")]),t._v(" "),s("p",[t._v("tmux还有非常多的功能，详细了解可以看这里https://github.com/tmux/tmux/wiki")])])}),[],!1,null,null,null);a.default=r.exports}}]);