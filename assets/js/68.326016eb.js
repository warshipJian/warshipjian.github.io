(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{419:function(t,a,r){"use strict";r.r(a);var s=r(26),e=Object(s.a)({},(function(){var t=this,a=t.$createElement,r=t._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"使用frp做内网穿透"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#使用frp做内网穿透"}},[t._v("#")]),t._v(" 使用frp做内网穿透")]),t._v(" "),r("h2",{attrs:{id:"简述"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#简述"}},[t._v("#")]),t._v(" 简述")]),t._v(" "),r("p",[t._v("之前用过ngrok，将内网的某个http服务暴露到公网。今天试试frp，将内网的服务器的ssh端口暴露到公网，实现外网直接访问内网服务器。\n过程和ngrok一样：\n"),r("img",{attrs:{src:"https://img.xiaoxiaoguo.cn/usr/uploads/2018/10/2723643911.png",alt:"frp.png"}})]),t._v(" "),r("ol",[r("li",[t._v("内网服务器(192.168.5.211)可以上网")]),t._v(" "),r("li",[t._v("外网有一台服务器，固定ip是1.2.3.4")]),t._v(" "),r("li",[t._v("通过frp将这两台服务器连接起来，1.2.3.4这台服务器会暴露出一个端口8090,用户通过这个端口，即可连接到内网服务器192.168.5.211的22端口")])]),t._v(" "),r("h2",{attrs:{id:"配置过程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#配置过程"}},[t._v("#")]),t._v(" 配置过程")]),t._v(" "),r("p",[t._v("服务器需要安装好go")]),t._v(" "),r("p",[t._v("本次使用的go版本是：go1.6.2")]),t._v(" "),r("p",[t._v("frp版本是：frp_0.21.0_linux_amd64")]),t._v(" "),r("p",[t._v("frp的地址是https://github.com/fatedier/frp，在上面下载好对应的版本，解压后的文件如下：")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("frpc           frpc_full.ini  frpc.ini       frps           frps_full.ini  frps.ini\n")])])]),r("p",[t._v("各个文件的作用如下：")]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[t._v("文件名")]),t._v(" "),r("th",[t._v("用途")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("frpc")]),t._v(" "),r("td",[t._v("客户端")])]),t._v(" "),r("tr",[r("td",[t._v("frpc_full")]),t._v(" "),r("td",[t._v("客户端的详细配置")])]),t._v(" "),r("tr",[r("td",[t._v("frpc.ini")]),t._v(" "),r("td",[t._v("客户端的简洁配置")])]),t._v(" "),r("tr",[r("td",[t._v("frps")]),t._v(" "),r("td",[t._v("服务端")])]),t._v(" "),r("tr",[r("td",[t._v("frps_full.ini")]),t._v(" "),r("td",[t._v("服务端的详细配置")])]),t._v(" "),r("tr",[r("td",[t._v("frps.ini")]),t._v(" "),r("td",[t._v("服务端的简洁配置")])])])]),t._v(" "),r("h3",{attrs:{id:"服务端配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#服务端配置"}},[t._v("#")]),t._v(" 服务端配置")]),t._v(" "),r("p",[t._v("进入frp_0.21.0_linux_amd64目录，修改frps.ini内容如下：")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("[common]\nbind_addr = 0.0.0.0\nbind_port = 9090 #客户端连接的端口\nlog_file = ./frps.log\nlog_level = info\nlog_max_days = 3\ntoken = 123456 #token验证\nallow_ports = 2000-3000,3001,3003,4000-50000,8090 #用于暴露到公网的端口\nmax_pool_count = 5\nmax_ports_per_client = 0\nauthentication_timeout = 900\ntcp_mux = true\n")])])]),r("p",[t._v("启动服务")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("./frps -c ./frps.ini\n")])])]),r("p",[t._v("如果看到类似如下信息，则是启动成功")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("2018/10/11 18:17:54 [I] [service.go:130] frps tcp listen on 0.0.0.0:9090\n2018/10/11 18:17:54 [I] [root.go:207] Start frps success\n")])])]),r("p",[t._v("可用nohup来启动，这样即使终端断开了，服务也会继续运行")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("nohup ./frps -c ./frps.ini &\n")])])]),r("h3",{attrs:{id:"客户端配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#客户端配置"}},[t._v("#")]),t._v(" 客户端配置")]),t._v(" "),r("p",[t._v("进入frp_0.21.0_linux_amd64目录，修改frpc.ini内容如下：")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("[common]\nserver_addr = 1.2.3.4 \nserver_port = 9090\ntoken = 123456 #和服务端设置的token一致\n\n[ssh]\ntype = tcp\nlocal_ip = 127.0.0.1\nlocal_port = 22\nremote_port = 8090 #暴露在公网的端口\n")])])]),r("p",[t._v("启动客户端")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("./frpc -c ./frpc.ini\n")])])]),r("p",[t._v("如果看到类似如下信息，则是启动成功")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("2018/10/11 06:31:23 [I] [proxy_manager.go:300] proxy removed: []\n2018/10/11 06:31:23 [I] [proxy_manager.go:310] proxy added: [ssh]\n2018/10/11 06:31:23 [I] [proxy_manager.go:333] visitor removed: []\n2018/10/11 06:31:23 [I] [proxy_manager.go:342] visitor added: []\n2018/10/11 06:31:23 [I] [control.go:246] [0a66cb717f83f5dd] login to server success, get run id [0a66cb717f83f5dd], server udp port [0]\n2018/10/11 06:31:23 [I] [control.go:169] [0a66cb717f83f5dd] [ssh] start proxy success\n")])])]),r("p",[t._v("在另一台外网机器上连接1.2.3.4的8090端口，如果能正常连接，并且访问的是192.168.5.211，则是配置成功了。\n同样，也可用nohup来启动，保证服务正常运行。")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("nohup ./frpc -c ./frpc.ini &\n")])])]),r("p",[t._v("如果要映射多个端口，需要启动多个frp服务，一个服务对应一组端口")]),t._v(" "),r("h2",{attrs:{id:"参考"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),r("p",[t._v("https://www.hi-linux.com/posts/25686.html")])])}),[],!1,null,null,null);a.default=e.exports}}]);